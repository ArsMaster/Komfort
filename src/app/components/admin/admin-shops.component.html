<div class="admin-shops">
  <div class="admin-header">
    <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞–º–∏</h1>
    <button class="btn-add" (click)="startAddShop()">
      <svg viewBox="0 0 24 24">
        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
      </svg>
      –î–æ–±–∞–≤–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω
    </button>
  </div>

  <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
  <div *ngIf="isEditing" class="edit-form">
    <h2>{{ editingShop ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ' : '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ' }} –º–∞–≥–∞–∑–∏–Ω–∞</h2>
    
    <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è —Ñ–∞–π–ª–æ–≤ -->
    <input 
      #fileInput
      type="file" 
      accept="image/*"
      (change)="onFileSelected($event)"
      style="display: none"
    >
    
    <div class="form-grid">
      <div class="form-group">
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞ *</label>
        <input 
          type="text" 
          [ngModel]="editingShop ? editingShop.title : newShop.title" 
          (ngModelChange)="editingShop ? editingShop.title = $event : newShop.title = $event"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ"
        >
      </div>

      <div class="form-group">
        <label>–ê–¥—Ä–µ—Å *</label>
        <input 
          type="text" 
          [ngModel]="editingShop ? editingShop.address : newShop.address" 
          (ngModelChange)="editingShop ? editingShop.address = $event : newShop.address = $event"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å"
        >
      </div>

      <!-- –ü–æ–ª–µ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –∫–Ω–æ–ø–∫–æ–π –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ -->
      <div class="form-group full-width">
        <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞</label>
        <div class="image-upload-section">
          <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
          <div *ngIf="imagePreview" class="image-preview">
            <img [src]="imagePreview" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
            <button type="button" class="btn-remove-image" (click)="removeImage()">
              √ó
            </button>
          </div>
          
          <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
          <div 
            class="upload-container" 
            [class.has-file]="selectedFileName"
            (click)="triggerFileInput()"
          >
            <svg class="upload-icon" viewBox="0 0 24 24">
              <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/>
            </svg>
            <div class="upload-text">
              <p class="upload-title">
                {{ selectedFileName || '–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' }}
              </p>
              <p class="upload-subtitle">
                {{ selectedFileName ? 
                   ('–§–∞–π–ª: ' + selectedFileName) : 
                   '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ (PNG, JPG, max 5MB)' 
                }}
              </p>
            </div>
          </div>
          
          <!-- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –≤–≤–æ–¥ URL -->
          <div class="url-alternative">
            <p>–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</p>
            <input 
              type="text" 
              [ngModel]="editingShop ? editingShop.imageUrl : newShop.imageUrl" 
              (ngModelChange)="editingShop ? editingShop.imageUrl = $event : newShop.imageUrl = $event"
              placeholder="https://example.com/shop-image.jpg"
              class="url-input"
            >
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
        <input 
          type="tel" 
          [ngModel]="editingShop ? editingShop.phone : newShop.phone" 
          (ngModelChange)="editingShop ? editingShop.phone = $event : newShop.phone = $event"
          placeholder="+7 (XXX) XXX-XX-XX"
        >
      </div>

      <div class="form-group">
        <label>Email</label>
        <input 
          type="email" 
          [ngModel]="editingShop ? editingShop.email : newShop.email" 
          (ngModelChange)="editingShop ? editingShop.email = $event : newShop.email = $event"
          placeholder="email@example.com"
        >
      </div>

      <div class="form-group">
        <label>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</label>
        <input 
          type="text" 
          [ngModel]="editingShop ? editingShop.workingHours : newShop.workingHours" 
          (ngModelChange)="editingShop ? editingShop.workingHours = $event : newShop.workingHours = $event"
          placeholder="–ü–Ω-–ü—Ç: 9:00-18:00"
        >
      </div>

      <div class="form-group full-width">
        <label>–û–ø–∏—Å–∞–Ω–∏–µ *</label>
        <textarea 
          [ngModel]="editingShop ? editingShop.description : newShop.description" 
          (ngModelChange)="editingShop ? editingShop.description = $event : newShop.description = $event"
          rows="4" 
          placeholder="–û–ø–∏—à–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω"
        ></textarea>
      </div>
    </div>

    <div class="form-actions">
      <button 
        class="btn-save" 
        (click)="saveShop()" 
        [disabled]="!validateForm() || isUploading"
        [class.loading]="isUploading"
      >
        {{ isUploading ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' }}
      </button>
      <button class="btn-cancel" (click)="cancelEdit()" [disabled]="isUploading">
        –û—Ç–º–µ–Ω–∞
      </button>
    </div>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤ -->
  <div *ngIf="!isEditing" class="shops-list">
    <div *ngFor="let shop of shops" class="shop-item">
      <div class="shop-item-preview">
        <img [src]="shop.imageUrl || '/assets/default-shop.jpg'" [alt]="shop.title">
        <div class="shop-item-info">
          <h3>{{ shop.title }}</h3>
          <p class="address">{{ shop.address }}</p>
          <p class="description">{{ truncateText(shop.description, 100) }}</p>
          <div class="shop-details">
            <span *ngIf="shop.phone">üìû {{ shop.phone }}</span>
            <span *ngIf="shop.workingHours">üïê {{ shop.workingHours }}</span>
          </div>
        </div>
      </div>
      
      <div class="shop-item-actions">
        <button class="btn-edit" (click)="startEditShop(shop)">
          <svg viewBox="0 0 24 24">
            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
          </svg>
          –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        </button>
        <button class="btn-delete" (click)="deleteShop(shop.id)">
          <svg viewBox="0 0 24 24">
            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
          </svg>
          –£–¥–∞–ª–∏—Ç—å
        </button>
      </div>
    </div>

    <div *ngIf="shops.length === 0" class="no-items">
      <p>–ú–∞–≥–∞–∑–∏–Ω—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω" —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π.</p>
    </div>
  </div>
</div>