<div class="product-card">
  <!-- Основной контейнер изображения -->
  <div class="product-image-container">
    <div class="product-image" (click)="openGallery()">
      <!-- Основное изображение -->
      <img 
        [src]="getCurrentImageUrl()" 
        [alt]="product.name"
        (error)="handleImageError($event)"
        class="main-image"
      >
      
      <!-- Стрелки для переключения (если больше 1 фото) -->
      @if (product.imageUrls && product.imageUrls.length > 1 && !showImageGallery) {
        <div class="image-nav">
          <button class="nav-btn prev" (click)="$event.stopPropagation(); prevImage($event)">‹</button>
          <button class="nav-btn next" (click)="$event.stopPropagation(); nextImage($event)">›</button>
        </div>
        
        <!-- Индикатор текущего изображения -->
        <div class="image-counter">
          {{ currentImageIndex + 1 }} / {{ product.imageUrls.length }}
        </div>
      }
      
      <div class="product-category">{{ product.categoryName || product.category }}</div>
      <div class="product-stock" [class.low-stock]="product.stock < 3">
        {{ product.stock }} в наличии
      </div>
    </div>
  </div>
  
  <!-- ИНФОРМАЦИЯ О ТОВАРЕ -->
  <div class="product-info">
    <h3 class="product-title">{{ product.name }}</h3>
    
    <!-- Цена -->
    <div class="product-price">
      {{ product.price | number:'1.0-0' }} ₽
    </div>
    
    <!-- Особенности (features) -->
    @if (product.features && product.features.length > 0) {
      <div class="product-features">
        <ul class="features-list">
          @for (feature of getFirstFeatures(3); track $index) {
            <li class="feature-item">
              <span class="feature-icon">✓</span> {{ feature }}
            </li>
          }
        </ul>
        @if (product.features.length > 3) {
          <div class="more-features">
            + ещё {{ product.features.length - 3 }} особенностей
          </div>
        }
      </div>
    }
    
    <!-- Описание товара -->
    @if (product.description) {
      <p class="product-description">
        {{ product.description | slice:0:120 }}{{ product.description.length > 120 ? '...' : '' }}
      </p>
    }
    
    <!-- Кнопки действий -->
    <!-- <div class="product-actions">
      <button class="btn-details" (click)="viewDetails()">
        Подробнее
      </button>
      
      <button class="btn-cart" 
              [disabled]="product.stock <= 0"
              (click)="addToCart()">
        {{ product.stock > 0 ? 'В корзину' : 'Нет в наличии' }}
      </button>
    </div> -->
    
    <!-- Админские кнопки (если нужно) -->
    @if (isAdmin) {
      <div class="admin-actions">
        <button class="btn-edit" (click)="editProduct()">Редактировать</button>
        <button class="btn-delete" (click)="deleteProduct()">Удалить</button>
      </div>
    }
  </div>
  
  <!-- Галерея (полноэкранный просмотр) -->
  @if (showImageGallery) {
    <div class="gallery-overlay" (click)="closeGallery($event)">
      <div class="gallery-content" (click)="$event.stopPropagation()">
        <button class="gallery-close" (click)="closeGallery($event)">×</button>
        
        <!-- Основное изображение в галерее -->
        <div class="gallery-main">
          <img [src]="getCurrentImageUrl()" [alt]="product.name" class="gallery-image">
        </div>
        
        <!-- Навигация в галерее -->
        @if (product.imageUrls && product.imageUrls.length > 1) {
          <div class="gallery-nav">
            <button class="gallery-prev" (click)="prevImage($event)">‹</button>
            <button class="gallery-next" (click)="nextImage($event)">›</button>
          </div>
          
          <!-- Миниатюры -->
          <div class="gallery-thumbnails">
            @for (image of getGalleryImages(); track $index) {
              <img 
                [src]="image" 
                [alt]="'Изображение ' + ($index + 1)"
                [class.active]="currentImageIndex === $index"
                (click)="setGalleryImage($index)"
              >
            }
          </div>
          
          <!-- Счетчик -->
          <div class="gallery-counter">
            {{ currentImageIndex + 1 }} / {{ product.imageUrls.length }}
          </div>
        }
      </div>
    </div>
  }
</div>