<div class="admin-page">
  <div class="admin-header">
    <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h1>
    <!-- –í admin-products.component.html –¥–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É -->
    <div class="admin-actions">
      <button class="btn btn-primary" (click)="showAddForm()">
        + –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
      </button>
      <button class="btn btn-secondary" (click)="exportProducts()">
        üì• –≠–∫—Å–ø–æ—Ä—Ç (JSON)
      </button>
      <button class="btn btn-secondary" (click)="importProducts()">
        üì§ –ò–º–ø–æ—Ä—Ç –∏–∑ Excel
      </button>
      <button class="btn btn-info" (click)="downloadTemplate()">
        üìÑ –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω Excel
      </button>
      <button class="btn btn-warning" (click)="resetProducts()">
        –°–±—Ä–æ—Å
      </button>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è -->
  @if (showDeleteModal) {
    <div class="modal-overlay" (click)="cancelDelete()">
      <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
        </div>
        <div class="modal-body">
          <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä "{{ productToDelete?.name }}"?</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="cancelDelete()">–û—Ç–º–µ–Ω–∞</button>
          <button class="btn btn-danger" (click)="confirmDelete()">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
      </div>
    </div>
  }

  <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
  @if (showForm) {
    <div class="admin-form">
      <h3>{{ editingProduct ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '–î–æ–±–∞–≤–∏—Ç—å' }} —Ç–æ–≤–∞—Ä</h3>
      
      <div class="form-group">
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:</label>
        <input [(ngModel)]="currentProduct.name" class="form-control" required>
      </div>
      
      <div class="form-group">
        <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
        <textarea [(ngModel)]="currentProduct.description" class="form-control" rows="4"></textarea>
      </div>
      
      <div class="form-group">
        <label>–¶–µ–Ω–∞:</label>
        <input type="number" [(ngModel)]="currentProduct.price" class="form-control" min="0" step="0.01">
      </div>
      
      <div class="form-group">
        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
        <select 
          [(ngModel)]="currentProduct.categoryId" 
          class="form-control" 
          required
          (change)="debugCategorySelect($event)">
          <option [value]="undefined" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
          @for (category of categories(); track category.id) {
            <option [value]="category.id">{{ category.title }}</option>
          }
        </select>
        
        <!-- –û—Ç–ª–∞–¥–∫–∞ -->
        @if (currentProduct.categoryId) {
          <div class="debug-info" style="margin-top: 5px; padding: 5px; background: #f0f0f0; border-radius: 3px;">
            <small style="color: #666;">
              –í—ã–±—Ä–∞–Ω ID: {{ currentProduct.categoryId }} (—Ç–∏–ø: {{ typeof currentProduct.categoryId }})<br>
              –ù–∞–∑–≤–∞–Ω–∏–µ: {{ getCategoryName(currentProduct.categoryId) }}
            </small>
          </div>
        }
        
        <small class="help-text">
          –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ —Å–ø–∏—Å–∫–∞. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏"
        </small>
      </div>
      
      <div class="form-group">
        <label>–û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ —Å–∫–ª–∞–¥–µ:</label>
        <input type="number" [(ngModel)]="currentProduct.stock" class="form-control" min="0">
      </div>
      
      <div class="form-group">
        <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (URL, –∫–∞–∂–¥–æ–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏):</label>
        <textarea [(ngModel)]="imageUrlsText" class="form-control" rows="4"></textarea>
        <small>–ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</small>
      </div>
      
      <div class="form-group">
        <label>–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
        <input type="file" 
               #multipleFileInput
               (change)="onFilesSelected($event)" 
               multiple 
               accept="image/*"
               class="form-control">
        <small>–ú–∞–∫—Å–∏–º—É–º 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</small>
      </div>
      
      @if (selectedFiles.length > 0) {
        <div class="file-previews">
          @for (file of selectedFiles; track $index) {
            <div class="file-preview">
              <img [src]="getFilePreview(file)" [alt]="file.name">
              <div class="file-info">
                <span>{{ getShortFileName(file.name, 20) }}</span>
                <button type="button" (click)="removeFile($index)" class="btn-remove">√ó</button>
              </div>
            </div>
          }
        </div>
      }
      
      <div class="form-group">
        <label>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–∫–∞–∂–¥–∞—è —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏):</label>
        <textarea [(ngModel)]="currentProduct.features" class="form-control" rows="3"></textarea>
      </div>
      
      <div class="form-actions">
        <button (click)="saveProduct()" class="btn btn-success">
          –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
        </button>
        <button (click)="cancelEdit()" class="btn btn-secondary">
          –û—Ç–º–µ–Ω–∞
        </button>
      </div>
    </div>
  }

  <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ -->
  <div class="products-list">
    @for (product of products(); track product.id) {
      <div class="product-item">
        <div class="product-image">
          <img [src]="product.imageUrls[0] || '/products/default.jpg'" [alt]="product.name">
        </div>
        <div class="product-info">
          <h4>{{ product.name }}</h4>
          <p class="product-description">{{ product.description }}</p>
          <div class="product-details">
            <span class="product-price">{{ product.price | number:'1.0-0' }} ‚ÇΩ</span>
            <span class="product-category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ product.categoryName || getCategoryName(product.categoryId) }}</span>
            <span class="product-stock">–û—Å—Ç–∞—Ç–æ–∫: {{ product.stock }}</span>
          </div>
        </div>
        <div class="product-actions">
          <button (click)="editProduct(product)" class="btn btn-sm btn-edit">
            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
          </button>
          <button (click)="deleteProduct(product)" class="btn btn-sm btn-danger">
            –£–¥–∞–ª–∏—Ç—å
          </button>
        </div>
      </div>
    }
  </div>
</div>