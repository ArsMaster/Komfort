import{a as j,b as H}from"./chunk-7CNCDI4I.js";import{b as U,c as W,d as R,g as $,i as G,m as q,o as Q}from"./chunk-47AB5WO2.js";import{$a as N,Ga as F,La as D,R as A,W as g,X as d,Xa as p,Ya as C,_a as V,a as O,ab as f,ac as L,bb as r,cb as o,db as P,ga as v,hb as w,jb as m,lb as s,nb as T,ob as I,pb as B,rb as E,sb as z,tb as u,ub as S,vb as _,wa as M,xb as h,ya as c,yb as x,zb as y}from"./chunk-2J5XD6IE.js";var Y=["fileInput"],K=(l,i)=>i.id;function X(l,i){if(l&1){let t=w();r(0,"div",8),m("click",function(){g(t);let n=s();return d(n.hideNotification())}),u(1),r(2,"button",9),u(3,"\xD7"),o()()}if(l&2){let t,e,n=s();z((t=n.notification())==null?null:t.type),c(),_(" ",(e=n.notification())==null?null:e.message," ")}}function Z(l,i){l&1&&(r(0,"div",3)(1,"div",10),P(2,"div",11),o()())}function tt(l,i){l&1&&(r(0,"div",15),u(1," \u042D\u0442\u043E\u0442 URL \u0443\u0436\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0441\u044F \u0434\u0440\u0443\u0433\u043E\u0439 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0435\u0439 "),o())}function et(l,i){if(l&1){let t=w();r(0,"div",21)(1,"div",28),P(2,"img",29),r(3,"div",30)(4,"span"),u(5),o(),r(6,"button",31),m("click",function(){g(t);let n=s(2);return d(n.clearFile())}),u(7," \xD7 "),o()()()()}if(l&2){let t=s(2);c(2),f("src",t.filePreview,M)("alt",t.selectedFile.name||"\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435"),c(3),S(t.selectedFile?t.getShortFileName(t.selectedFile.name,25):"")}}function nt(l,i){if(l&1&&(r(0,"div",22)(1,"p"),u(2,"\u0422\u0435\u043A\u0443\u0449\u0435\u0435 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435:"),o(),P(3,"img",32),o()),l&2){let t=s(2);c(3),f("src",t.currentCategory.image,M)("alt",t.currentCategory.title)}}function it(l,i){if(l&1){let t=w();r(0,"div",5)(1,"h3"),u(2),o(),r(3,"div",12)(4,"label"),u(5,"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438:"),o(),r(6,"input",13),y("ngModelChange",function(n){g(t);let a=s();return x(a.currentCategory.title,n)||(a.currentCategory.title=n),d(n)}),m("input",function(){g(t);let n=s();return d(n.onTitleChange())}),o()(),r(7,"div",12)(8,"label"),u(9,"URL \u0430\u0434\u0440\u0435\u0441 (\u0433\u0435\u043D\u0435\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044F \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438):"),o(),r(10,"input",14),y("ngModelChange",function(n){g(t);let a=s();return x(a.currentCategory.slug,n)||(a.currentCategory.slug=n),d(n)}),m("blur",function(){g(t);let n=s();return d(n.onSlugBlur())}),o(),p(11,tt,2,0,"div",15),r(12,"small",16),u(13," \u042D\u0442\u043E\u0442 \u0430\u0434\u0440\u0435\u0441 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0441\u044F \u0432 \u0441\u0441\u044B\u043B\u043A\u0430\u0445 \u043D\u0430 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E. \u041E\u0441\u0442\u0430\u0432\u044C\u0442\u0435 \u043F\u0443\u0441\u0442\u044B\u043C \u0434\u043B\u044F \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u043E\u0439 \u0433\u0435\u043D\u0435\u0440\u0430\u0446\u0438\u0438 "),o()(),r(14,"div",12)(15,"label"),u(16,"\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438:"),o(),r(17,"input",17),y("ngModelChange",function(n){g(t);let a=s();return x(a.currentCategory.image,n)||(a.currentCategory.image=n),d(n)}),o(),r(18,"div",18)(19,"label",19)(20,"input",20,0),m("change",function(n){g(t);let a=s();return d(a.onFileSelected(n))}),o()(),p(22,et,8,3,"div",21),p(23,nt,4,2,"div",22),o(),r(24,"small",16),u(25," \u0423\u043A\u0430\u0436\u0438\u0442\u0435 URL \u0438\u043B\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 (JPG, PNG, GIF). \u0420\u0435\u043A\u043E\u043C\u0435\u043D\u0434\u0443\u0435\u043C\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440: 400\xD7400px "),o()(),r(26,"div",12)(27,"label"),u(28,"\u041F\u043E\u0440\u044F\u0434\u043E\u043A \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F:"),o(),r(29,"input",23),y("ngModelChange",function(n){g(t);let a=s();return x(a.currentCategory.order,n)||(a.currentCategory.order=n),d(n)}),o()(),r(30,"div",12)(31,"label")(32,"input",24),y("ngModelChange",function(n){g(t);let a=s();return x(a.currentCategory.isActive,n)||(a.currentCategory.isActive=n),d(n)}),o(),u(33," \u0410\u043A\u0442\u0438\u0432\u043D\u0430\u044F \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F "),o()(),r(34,"div",25)(35,"button",26),m("click",function(){g(t);let n=s();return d(n.saveCategory())}),u(36),o(),r(37,"button",27),m("click",function(){g(t);let n=s();return d(n.cancelEdit())}),u(38," \u041E\u0442\u043C\u0435\u043D\u0430 "),o()()()}if(l&2){let t=s();c(2),_("",t.editingCategory?"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C":"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C"," \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E"),c(4),h("ngModel",t.currentCategory.title),c(4),E("is-invalid",t.currentCategory.slug&&!t.isSlugValid(t.currentCategory.slug)),h("ngModel",t.currentCategory.slug),c(),C(t.currentCategory.slug&&!t.isSlugUnique(t.currentCategory.slug,t.currentCategory.id)?11:-1),c(6),h("ngModel",t.currentCategory.image),c(5),C(t.selectedFile?22:-1),c(),C(!t.selectedFile&&t.currentCategory.image?23:-1),c(6),h("ngModel",t.currentCategory.order),c(3),h("ngModel",t.currentCategory.isActive),f("checked",t.currentCategory.isActive??!0),c(3),f("disabled",t.isLoading()),c(),_(" ",t.editingCategory?"\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C":"\u0421\u043E\u0437\u0434\u0430\u0442\u044C"," \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E "),c(),f("disabled",t.isLoading())}}function ot(l,i){if(l&1){let t=w();r(0,"div",33)(1,"img",34),m("error",function(){let n=g(t).$implicit;return d(n.image="/assets/default-category.jpg")}),o(),r(2,"div",35)(3,"h4"),u(4),o(),r(5,"div",36)(6,"span",37)(7,"strong"),u(8,"URL:"),o(),u(9),o(),r(10,"span",37)(11,"strong"),u(12,"\u041F\u043E\u0440\u044F\u0434\u043E\u043A:"),o(),u(13),o(),r(14,"span",37)(15,"strong"),u(16,"\u0421\u0442\u0430\u0442\u0443\u0441:"),o(),r(17,"span",38),u(18),o()()()(),r(19,"div",39)(20,"button",40),m("click",function(){let n=g(t).$implicit,a=s(2);return d(a.editCategory(n))}),u(21," \u270F\uFE0F "),o(),r(22,"button",41),m("click",function(){let n=g(t).$implicit,a=s(2);return d(a.deleteCategory(n))}),u(23," \u{1F5D1}\uFE0F "),o()()()}if(l&2){let t=i.$implicit;c(),f("src",t.image||"/assets/default-category.jpg",M)("alt",t.title),c(3),S(t.title),c(5),_(" ",t.slug," "),c(4),_(" ",t.order," "),c(4),E("active",t.isActive),c(),_(" ",t.isActive?"\u0410\u043A\u0442\u0438\u0432\u043D\u0430":"\u041D\u0435\u0430\u043A\u0442\u0438\u0432\u043D\u0430"," ")}}function rt(l,i){if(l&1&&(r(0,"div",6),V(1,ot,24,8,"div",33,K),o()),l&2){let t=s();c(),N(t.categories())}}function at(l,i){l&1&&(r(0,"div",7)(1,"div",42),u(2,"\u{1F4C1}"),o(),r(3,"h3"),u(4,"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 \u043D\u0435 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u044B"),o(),r(5,"p"),u(6,'\u041D\u0430\u0436\u043C\u0438\u0442\u0435 "\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E", \u0447\u0442\u043E\u0431\u044B \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0435\u0440\u0432\u0443\u044E \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E'),o()())}var J=class l{constructor(i){this.catalogService=i}fileInput;categories=v([],{});showForm=!1;editingCategory=!1;showSlugField=!1;currentCategory=this.getEmptyCategory();selectedFile=null;filePreview="";notification=v(null,{});isLoading=v(!1,{});subscription;storageService=A(H);ngOnInit(){this.subscription=this.catalogService.categories$.subscribe(i=>{this.categories.set(i)})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}getEmptyCategory(){return{title:"",image:"",slug:"",order:0,isActive:!0}}generateSlug(i){return i.toLowerCase().replace(/[а-яё]/g,t=>({\u0430:"a",\u0431:"b",\u0432:"v",\u0433:"g",\u0434:"d",\u0435:"e",\u0451:"yo",\u0436:"zh",\u0437:"z",\u0438:"i",\u0439:"y",\u043A:"k",\u043B:"l",\u043C:"m",\u043D:"n",\u043E:"o",\u043F:"p",\u0440:"r",\u0441:"s",\u0442:"t",\u0443:"u",\u0444:"f",\u0445:"kh",\u0446:"ts",\u0447:"ch",\u0448:"sh",\u0449:"shch",\u044A:"",\u044B:"y",\u044C:"",\u044D:"e",\u044E:"yu",\u044F:"ya"})[t]||t).replace(/[^a-z0-9]/g,"-").replace(/--+/g,"-").replace(/^-|-$/g,"")}cleanSlug(i){return i?i.toLowerCase().trim().replace(/[^a-zа-яё0-9-]/g,"-").replace(/--+/g,"-").replace(/^-|-$/g,""):""}isSlugValid(i){return i?/^[a-z0-9]+(?:-[a-z0-9]+)*$/.test(i):!0}isSlugUnique(i,t){return i?!this.categories().find(a=>a.slug===i&&(!t||a.id!==t)):!0}onSlugBlur(){this.currentCategory.slug?this.currentCategory.slug=this.cleanSlug(this.currentCategory.slug):this.currentCategory.title&&(this.currentCategory.slug=this.generateSlug(this.currentCategory.title))}onTitleChange(){(!this.editingCategory||!this.currentCategory.slug)&&(this.currentCategory.slug=this.generateSlug(this.currentCategory.title||""))}onFileSelected(i){let t=i.target;if(t.files&&t.files[0]){let e=t.files[0];if(!e.type.match("image.*")){this.showNotification("error","\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 (JPG, PNG, GIF)");return}if(e.size>5*1024*1024){this.showNotification("error","\u0424\u0430\u0439\u043B \u0441\u043B\u0438\u0448\u043A\u043E\u043C \u0431\u043E\u043B\u044C\u0448\u043E\u0439. \u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440: 5MB");return}this.selectedFile=e;let n=new FileReader;n.onload=a=>{this.filePreview=a.target?.result,this.currentCategory.image=this.filePreview},n.readAsDataURL(e)}}getShortFileName(i,t){if(!i)return"";if(i.length<=t)return i;let e=i.lastIndexOf(".");if(e===-1)return i.substring(0,t-3)+"...";let n=i.substring(0,e),a=i.substring(e+1);return n.length<=t-a.length-4?i:`${n.substring(0,t-a.length-4)}...${a}`}clearFile(){this.selectedFile=null,this.filePreview="",this.currentCategory.image="",this.fileInput&&(this.fileInput.nativeElement.value="")}showAddForm(){this.currentCategory=this.getEmptyCategory(),this.editingCategory=!1,this.showForm=!0,this.showSlugField=!1,this.clearFile()}editCategory(i){this.currentCategory=O({},i),this.editingCategory=!0,this.showForm=!0,this.showSlugField=!0,this.clearFile()}async saveCategory(){if(!this.currentCategory.title?.trim()){this.showNotification("error","\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0443\u043A\u0430\u0436\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438");return}if(this.currentCategory.slug?.trim()?this.currentCategory.slug=this.cleanSlug(this.currentCategory.slug):this.currentCategory.slug=this.generateSlug(this.currentCategory.title),!this.isSlugValid(this.currentCategory.slug)){this.showNotification("error","URL \u0430\u0434\u0440\u0435\u0441 \u0441\u043E\u0434\u0435\u0440\u0436\u0438\u0442 \u043D\u0435\u0434\u043E\u043F\u0443\u0441\u0442\u0438\u043C\u044B\u0435 \u0441\u0438\u043C\u0432\u043E\u043B\u044B. \u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435 \u0442\u043E\u043B\u044C\u043A\u043E \u043B\u0430\u0442\u0438\u043D\u0441\u043A\u0438\u0435 \u0431\u0443\u043A\u0432\u044B, \u0446\u0438\u0444\u0440\u044B \u0438 \u0434\u0435\u0444\u0438\u0441\u044B");return}if(!this.isSlugUnique(this.currentCategory.slug,this.currentCategory.id)){this.showNotification("error","\u042D\u0442\u043E\u0442 URL \u0443\u0436\u0435 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0441\u044F \u0434\u0440\u0443\u0433\u043E\u0439 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0435\u0439");return}this.isLoading.set(!0);try{let i=this.currentCategory.image||"";if(this.selectedFile){console.log("\u{1F4E4} \u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 \u0447\u0435\u0440\u0435\u0437 CatalogService...");try{let e=await this.catalogService.uploadCategoryImages([this.selectedFile]).then(n=>n[0]);i=e,console.log("\u2705 \u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E \u0447\u0435\u0440\u0435\u0437 CatalogService:",e)}catch(e){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0444\u0430\u0439\u043B\u0430:",e),e.message.includes("bucket")||e.message.includes("policy")?this.showNotification("error",`\u041E\u0448\u0438\u0431\u043A\u0430 \u043A\u043E\u043D\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 Storage. \u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435:
1. Bucket "category-images" \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 Supabase
2. RLS \u043F\u043E\u043B\u0438\u0442\u0438\u043A\u0438 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043D\u044B \u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u043E
3. Bucket \u043F\u0443\u0431\u043B\u0438\u0447\u043D\u044B\u0439`):e.message.includes("upsert")?this.showNotification("error","\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u043E\u0432 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438. \u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435 \u0443\u043D\u0438\u043A\u0430\u043B\u044C\u043D\u044B\u0435 \u0438\u043C\u0435\u043D\u0430 \u0444\u0430\u0439\u043B\u043E\u0432."):this.showNotification("error",`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435: ${e.message}`),this.isLoading.set(!1);return}}if(this.selectedFile){console.log("\u{1F4E4} \u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438...");try{let e=await this.catalogService.uploadCategoryImages([this.selectedFile]).then(n=>n[0]);i=e,console.log("\u2705 \u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E \u0447\u0435\u0440\u0435\u0437 CatalogService:",e)}catch(e){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0444\u0430\u0439\u043B\u0430:",e),e.message.includes("bucket")||e.message.includes("policy")?this.showNotification("error",'\u041E\u0448\u0438\u0431\u043A\u0430 \u043A\u043E\u043D\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 Storage. \u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 bucket "category-images" \u0432 Supabase Dashboard'):this.showNotification("error",`\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435: ${e.message}`),this.isLoading.set(!1);return}}else if(this.currentCategory.image&&this.currentCategory.image.startsWith("data:image")){console.log("\u{1F504} \u041A\u043E\u043D\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044F Base64 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438...");try{let e=this.base64ToFile(this.currentCategory.image,`${this.currentCategory.slug||"category"}-${Date.now()}.jpg`),n=await this.storageService.uploadFile(e,"category-images","categories");i=n,console.log("\u2705 Base64 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043E:",n)}catch(e){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043A\u043E\u043D\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u0438 Base64:",e),i="/assets/default-category.jpg"}}else this.currentCategory.image&&!this.currentCategory.image.includes("supabase.co")&&!this.currentCategory.image.startsWith("/assets/")&&(i="/assets/default-category.jpg");let t={title:this.currentCategory.title.trim(),image:i,slug:this.currentCategory.slug.trim(),description:this.currentCategory.description?.trim()||"",order:this.currentCategory.order||0,isActive:this.currentCategory.isActive??!0};if(this.editingCategory&&this.currentCategory.id){let e=O({},t);await this.catalogService.updateCategory(this.currentCategory.id,e)?this.showNotification("success",`\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F "${this.currentCategory.title}" \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0430!`):this.showNotification("error","\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E")}else{let e=await this.catalogService.addCategory(t);e?this.showNotification("success",`\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F "${e.title}" \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0430!`):this.showNotification("error","\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E")}await this.categories(),this.cancelEdit()}catch(i){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0438 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438:",i),this.showNotification("error","\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0438 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438")}finally{this.isLoading.set(!1)}}base64ToFile(i,t){let e=i.split(","),n=e[0].match(/:(.*?);/)?.[1]||"image/jpeg",a=atob(e[1]),b=a.length,k=new Uint8Array(b);for(;b--;)k[b]=a.charCodeAt(b);return new File([k],t,{type:n})}async deleteCategory(i){if(confirm(`\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E "${i.title}"?
\u042D\u0442\u0430 \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u044F \u043D\u0435\u043E\u0431\u0440\u0430\u0442\u0438\u043C\u0430.`)){this.isLoading.set(!0);try{await this.catalogService.deleteCategory(i.id)?this.showNotification("success",`\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F "${i.title}" \u0443\u0434\u0430\u043B\u0435\u043D\u0430`):this.showNotification("error","\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E")}catch(t){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438:",t),this.showNotification("error","\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438")}finally{this.isLoading.set(!1)}}}cancelEdit(){this.showForm=!1,this.editingCategory=!1,this.showSlugField=!1,this.currentCategory=this.getEmptyCategory(),this.clearFile()}showNotification(i,t){this.notification.set({type:i,message:t}),setTimeout(()=>{this.notification.set(null)},5e3)}hideNotification(){this.notification.set(null)}static \u0275fac=function(t){return new(t||l)(F(j))};static \u0275cmp=D({type:l,selectors:[["app-admin-catalog"]],viewQuery:function(t,e){if(t&1&&T(Y,5),t&2){let n;I(n=B())&&(e.fileInput=n.first)}},decls:10,vars:4,consts:[["fileInput",""],[1,"admin-section"],[1,"notification",3,"class"],[1,"loading-overlay"],[1,"btn","btn-primary",3,"click"],[1,"admin-form"],[1,"categories-list"],[1,"empty-state"],[1,"notification",3,"click"],[1,"notification-close"],[1,"loading-spinner"],[1,"spinner"],[1,"form-group"],["placeholder","\u041D\u0430\u043F\u0440\u0438\u043C\u0435\u0440: \u0413\u043E\u0441\u0442\u0438\u043D\u0430\u044F",1,"form-control",3,"ngModelChange","input","ngModel"],["placeholder","gostinaya",1,"form-control",3,"ngModelChange","blur","ngModel"],[1,"invalid-feedback"],[1,"help-text"],["placeholder","URL \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u0438\u043B\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0444\u0430\u0439\u043B",1,"form-control",3,"ngModelChange","ngModel"],[1,"file-upload-section"],[1,"file-upload-label"],["type","file","accept","image/*",1,"file-input",3,"change"],[1,"file-info"],[1,"current-image"],["type","number","min","0","placeholder","0",1,"form-control",3,"ngModelChange","ngModel"],["type","checkbox",3,"ngModelChange","ngModel","checked"],[1,"form-actions"],[1,"btn","btn-success",3,"click","disabled"],[1,"btn","btn-secondary",3,"click","disabled"],[1,"file-preview"],[1,"preview-image",2,"max-width","120px","max-height","120px","object-fit","contain",3,"src","alt"],[1,"file-details"],["type","button",1,"btn-remove",3,"click"],[1,"current-image-preview",2,"max-width","200px","max-height","150px","object-fit","contain",3,"src","alt"],[1,"category-item"],[1,"category-thumb",3,"error","src","alt"],[1,"category-info"],[1,"category-details"],[1,"detail-item"],[1,"status-badge"],[1,"category-actions"],["title","\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",1,"btn","btn-sm","btn-edit",3,"click"],["title","\u0423\u0434\u0430\u043B\u0438\u0442\u044C",1,"btn","btn-sm","btn-danger",3,"click"],[1,"empty-icon"]],template:function(t,e){t&1&&(r(0,"div",1)(1,"h2"),u(2,"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u043A\u0430\u0442\u0430\u043B\u043E\u0433\u0430\u043C\u0438"),o(),p(3,X,4,3,"div",2),p(4,Z,3,0,"div",3),r(5,"button",4),m("click",function(){return e.showAddForm()}),u(6," + \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044E "),o(),p(7,it,39,15,"div",5),p(8,rt,3,0,"div",6)(9,at,7,0,"div",7),o()),t&2&&(c(3),C(e.notification()?3:-1),c(),C(e.isLoading()?4:-1),c(3),C(e.showForm?7:-1),c(),C(e.categories().length>0?8:9))},dependencies:[L,Q,W,G,U,R,q,$],styles:[`@charset "UTF-8";.admin-section[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.admin-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#333;margin-bottom:20px;font-size:24px}.btn[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-size:14px;font-weight:500;transition:all .3s ease;text-decoration:none;display:inline-flex;align-items:center;gap:8px}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0056b3}.btn-success[_ngcontent-%COMP%]{background-color:#28a745;color:#fff}.btn-success[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#1e7e34}.btn-secondary[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#545b62}.btn-danger[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#bd2130}.btn-sm[_ngcontent-%COMP%]{padding:5px 10px;font-size:12px}.btn-edit[_ngcontent-%COMP%]{background-color:#ffc107;color:#212529}.btn-edit[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#e0a800}.admin-form[_ngcontent-%COMP%]{background:#fff;border:1px solid #dee2e6;border-radius:8px;padding:25px;margin:25px 0;box-shadow:0 2px 10px #0000001a}.admin-form[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#333;margin-bottom:20px;font-size:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-weight:500;color:#555}.form-control[_ngcontent-%COMP%]{width:100%;padding:10px 15px;border:1px solid #ced4da;border-radius:4px;font-size:14px;transition:border-color .3s}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#007bff;box-shadow:0 0 0 .2rem #007bff40}.form-actions[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:25px;padding-top:20px;border-top:1px solid #dee2e6}.categories-list[_ngcontent-%COMP%]{margin-top:30px}.category-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px;padding:15px;border:1px solid #dee2e6;border-radius:8px;margin-bottom:15px;background:#fff;transition:box-shadow .3s}.category-item[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #0000001a}.category-thumb[_ngcontent-%COMP%]{width:80px!important;height:80px!important;object-fit:cover!important;border-radius:6px;border:1px solid #eee}.category-info[_ngcontent-%COMP%]{flex:1}.category-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 8px;color:#333;font-size:18px}.category-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0;color:#666;font-size:14px}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500}.status-badge.active[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724}.status-badge[_ngcontent-%COMP%]:not(.active){background-color:#f8d7da;color:#721c24}.category-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.file-upload-section[_ngcontent-%COMP%]{margin-top:10px}.file-preview[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px;margin-top:10px;padding:10px;background-color:#f8f9fa;border-radius:6px;border:1px solid #e9ecef}.preview-image[_ngcontent-%COMP%]{width:120px!important;height:120px!important;object-fit:contain!important;border-radius:6px;border:1px solid #dee2e6;background-color:#fff;padding:5px}.file-details[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;font-size:14px;color:#495057}.btn-remove[_ngcontent-%COMP%]{background:#dc3545;color:#fff;border:none;border-radius:50%;width:24px;height:24px;font-size:16px;line-height:1;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:0}.btn-remove[_ngcontent-%COMP%]:hover{background:#c82333}.current-image[_ngcontent-%COMP%]{margin-top:15px}.current-image[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:8px;font-size:14px;color:#495057}.current-image-preview[_ngcontent-%COMP%]{max-width:200px!important;max-height:150px!important;width:auto!important;height:auto!important;object-fit:contain!important;border-radius:6px;border:1px solid #dee2e6;background-color:#fff;padding:5px;display:block!important}.help-text[_ngcontent-%COMP%]{display:block;margin-top:8px;color:#6c757d;font-size:12px}@media(max-width:768px){.admin-section[_ngcontent-%COMP%]{padding:15px}.category-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:15px}.category-thumb[_ngcontent-%COMP%]{width:100%!important;height:150px!important;max-width:100%!important}.category-actions[_ngcontent-%COMP%]{width:100%;justify-content:flex-end}.form-actions[_ngcontent-%COMP%]{flex-direction:column}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}.preview-image[_ngcontent-%COMP%]{width:100px!important;height:100px!important}.current-image-preview[_ngcontent-%COMP%]{max-width:150px!important;max-height:120px!important}}@media(max-width:480px){.preview-image[_ngcontent-%COMP%]{width:80px!important;height:80px!important}.current-image-preview[_ngcontent-%COMP%]{max-width:120px!important;max-height:100px!important}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.admin-form[_ngcontent-%COMP%], .category-item[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:50px 20px;color:#6c757d}.empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:20px;opacity:.5}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:10px}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.section-header[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{margin:0}.notification[_ngcontent-%COMP%]{padding:12px 20px;border-radius:4px;margin-bottom:20px;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.notification[_ngcontent-%COMP%]{padding:12px 20px;border-radius:6px;margin-bottom:20px;animation:_ngcontent-%COMP%_fadeIn .3s ease-out;display:flex;justify-content:space-between;align-items:center;cursor:pointer;position:relative}.notification.success[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724;border:1px solid #c3e6cb}.notification.error[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.notification[_ngcontent-%COMP%]   .notification-close[_ngcontent-%COMP%]{background:none;border:none;color:inherit;font-size:20px;line-height:1;cursor:pointer;opacity:.7;padding:0;margin-left:10px}.notification[_ngcontent-%COMP%]   .notification-close[_ngcontent-%COMP%]:hover{opacity:1}.loading-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#fffc;display:flex;justify-content:center;align-items:center;z-index:1000}.loading-spinner[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:4px solid #f3f3f3;border-top:4px solid #007bff;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:40px}.loading-spinner[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #007bff;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:30px;max-width:400px;width:90%;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.modal[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]{margin-bottom:20px}.modal[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#333}.modal[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{margin-bottom:20px;color:#666}.modal[_ngcontent-%COMP%]   .modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px}.form-control.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545;padding-right:calc(1.5em + .75rem);background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right calc(.375em + .1875rem) center;background-size:calc(.75em + .375rem) calc(.75em + .375rem)}.invalid-feedback[_ngcontent-%COMP%]{display:block;width:100%;margin-top:.25rem;font-size:.875em;color:#dc3545}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-right:8px;vertical-align:middle}@media(max-width:768px){.category-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.detail-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px}}`]})};export{J as AdminCatalogComponent};
