import{a as g}from"./chunk-47AB5WO2.js";import{M as r,Q as l,a as s,b as n,h as i}from"./chunk-2J5XD6IE.js";var u=class c{constructor(o){this.supabaseService=o;console.log("=== ContactService \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D ==="),window.contactService=this,window.contactServiceDebug={getMode:()=>this.storageMode,testConnection:()=>this.testConnection(),testAll:()=>this.testAllOperations(),forceLoadFromSupabase:()=>this.forceLoadFromSupabase(),clearCache:()=>this.clearCache(),addTestSocial:()=>this.addTestSocial()},this.initialize()}contactsSubject=new i(this.getDefaultContacts());contacts$=this.contactsSubject.asObservable();storageMode="local";storageKey="komfort_contacts";isInitialized=!1;async initialize(){this.isInitialized||(this.storageMode=localStorage.getItem("komfort_storage_mode")||"supabase",console.log("\u{1F527} \u0420\u0435\u0436\u0438\u043C \u0440\u0430\u0431\u043E\u0442\u044B ContactService:",this.storageMode),this.storageMode==="local"?this.loadFromLocalStorage():await this.loadFromSupabase(),this.isInitialized=!0,console.log("\u2705 ContactService \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D"))}loadFromLocalStorage(){let o=localStorage.getItem(this.storageKey);if(o)try{let t=JSON.parse(o);this.contactsSubject.next(t),console.log("\u{1F4E6} \u041A\u043E\u043D\u0442\u0430\u043A\u0442\u044B \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u044B \u0438\u0437 localStorage")}catch(t){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u043A\u043E\u043D\u0442\u0430\u043A\u0442\u043E\u0432 \u0438\u0437 localStorage:",t),this.contactsSubject.next(this.getDefaultContacts())}else{console.log("\u{1F4ED} \u041D\u0435\u0442 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u043D\u044B\u0445 \u043A\u043E\u043D\u0442\u0430\u043A\u0442\u043E\u0432, \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u044E\u0442\u0441\u044F \u043D\u0430\u0447\u0430\u043B\u044C\u043D\u044B\u0435");let t=this.getDefaultContacts();this.contactsSubject.next(t),this.saveToLocalStorage(t)}}async loadFromSupabase(){console.log("\u{1F504} \u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043A\u043E\u043D\u0442\u0430\u043A\u0442\u043E\u0432 \u0438\u0437 Supabase...");try{if(!await this.testConnection()){console.warn("\u26A0\uFE0F \u041D\u0435\u0442 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044F \u043A Supabase, \u043F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0430\u0435\u043C\u0441\u044F \u043D\u0430 localStorage"),this.storageMode="local",this.loadFromLocalStorage();return}let t=await this.supabaseService.getContactInfo();if(t){let e={id:t.id,phone:t.phone||"",email:t.email||"",office:t.office||"",workingHours:t.workingHours||"",mapEmbed:t.mapEmbed||"",social:t.social||[]};this.contactsSubject.next(e),this.saveToLocalStorage(e),console.log("\u2705 \u041A\u043E\u043D\u0442\u0430\u043A\u0442\u044B \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u044B \u0438\u0437 Supabase")}else{console.log("\u{1F4ED} Supabase: \u043D\u0435\u0442 \u043A\u043E\u043D\u0442\u0430\u043A\u0442\u043E\u0432, \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u044B\u0435");let e=this.getDefaultContacts();this.contactsSubject.next(e),this.saveToLocalStorage(e)}}catch(o){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0438\u0437 Supabase:",o),console.log("\u{1F504} \u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0430\u0435\u043C\u0441\u044F \u043D\u0430 LocalStorage"),this.storageMode="local",this.loadFromLocalStorage()}}saveToLocalStorage(o){let t=o||this.getContacts();try{localStorage.setItem(this.storageKey,JSON.stringify(t)),console.log("\u{1F4BE} \u041A\u043E\u043D\u0442\u0430\u043A\u0442\u044B \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u044B \u0432 localStorage (\u043A\u044D\u0448)")}catch(e){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F \u0432 localStorage:",e)}}getContacts(){return this.contactsSubject.getValue()}async updateContacts(o){console.log("\u270F\uFE0F \u041E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435 \u043A\u043E\u043D\u0442\u0430\u043A\u0442\u043E\u0432 \u0432 \u0440\u0435\u0436\u0438\u043C\u0435:",this.storageMode);let t=this.getContacts(),e=s(s({},t),o);if(this.contactsSubject.next(e),this.storageMode==="local")this.saveToLocalStorage(e),console.log("\u2705 \u041A\u043E\u043D\u0442\u0430\u043A\u0442\u044B \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B \u0432 LocalStorage");else try{this.saveToLocalStorage(e),await this.supabaseService.updateContactInfo(e)?(this.saveToLocalStorage(e),console.log("\u2705 \u041A\u043E\u043D\u0442\u0430\u043A\u0442\u044B \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0441 Supabase")):(console.warn("\u26A0\uFE0F \u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0441 Supabase, \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u043E \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u043E"),this.saveToLocalStorage(e))}catch(a){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u0432 Supabase:",a)}}async addSocial(o){console.log("\u2795 \u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0441\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0439 \u0441\u0435\u0442\u0438 \u0432 \u0440\u0435\u0436\u0438\u043C\u0435:",this.storageMode);let t=this.getContacts(),e=n(s({},t),{social:[...t.social,o]});await this.updateContacts({social:e.social}),console.log("\u2705 \u0421\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u0430\u044F \u0441\u0435\u0442\u044C \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0430")}async removeSocial(o){console.log("\u{1F5D1}\uFE0F \u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435 \u0441\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0439 \u0441\u0435\u0442\u0438 \u0432 \u0440\u0435\u0436\u0438\u043C\u0435:",this.storageMode);let e=this.getContacts().social.filter((a,h)=>h!==o);await this.updateContacts({social:e}),console.log("\u2705 \u0421\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u0430\u044F \u0441\u0435\u0442\u044C \u0443\u0434\u0430\u043B\u0435\u043D\u0430")}async updateSocial(o,t){console.log("\u270F\uFE0F \u041E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435 \u0441\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0439 \u0441\u0435\u0442\u0438 \u0432 \u0440\u0435\u0436\u0438\u043C\u0435:",this.storageMode);let a=[...this.getContacts().social];o>=0&&o<a.length?(a[o]=s(s({},a[o]),t),await this.updateContacts({social:a}),console.log("\u2705 \u0421\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u0430\u044F \u0441\u0435\u0442\u044C \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0430")):console.error("\u274C \u0418\u043D\u0434\u0435\u043A\u0441 \u0441\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0439 \u0441\u0435\u0442\u0438 \u0432\u043D\u0435 \u0434\u0438\u0430\u043F\u0430\u0437\u043E\u043D\u0430")}getDefaultContacts(){return{id:1,phone:"+7 (938) 505-00-07",email:"komfort.smm@mail.ru",office:'\u0433. \u0428\u0435\u043B\u043A\u043E\u0432\u0441\u043A\u0430\u044F, \u0443\u043B. \u041A\u043E\u0441\u0430\u044F, 47, \u0422\u0414 "\u041A\u043E\u043C\u0444\u043E\u0440\u0442"',social:[{name:"Instagram",url:"https://www.instagram.com/td_komfort_shelk/",icon:"IN"},{name:"Telegram",url:"https://t.me/komfort_company",icon:"TG"},{name:"WhatsApp",url:"https://wa.me/78005553535",icon:"WA"}],workingHours:"\u041F\u043D-\u041F\u0442: 9:00-18:00, \u0421\u0431: 10:00-16:00",mapEmbed:'<iframe src="https://yandex.ru/map-widget/v1/?um=constructor%3A..." width="100%" height="100%" frameborder="0"></iframe>'}}getStorageMode(){return this.storageMode}async switchStorageMode(o){if(this.storageMode===o){console.log(`\u2139\uFE0F \u0423\u0436\u0435 \u0432 \u0440\u0435\u0436\u0438\u043C\u0435 ${o}`);return}console.log(`\u{1F504} \u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435 \u0440\u0435\u0436\u0438\u043C\u0430 \u0441 ${this.storageMode} \u043D\u0430 ${o}`),this.storageMode=o,o==="local"?this.loadFromLocalStorage():await this.loadFromSupabase()}async testConnection(){console.log("\u{1F50C} \u0422\u0435\u0441\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044F \u043A Supabase (Contact)...");try{let o=await this.supabaseService.getContactInfo();return console.log("\u2705 \u041F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435 \u043A Supabase \u0443\u0441\u043F\u0435\u0448\u043D\u043E"),!0}catch(o){return console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044F:",o.message||o),!1}}async testAllOperations(){if(console.log("\u{1F9EA} \u0417\u0430\u043F\u0443\u0441\u043A \u0442\u0435\u0441\u0442\u043E\u0432\u044B\u0445 \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u0439 ContactService..."),!await this.testConnection()){console.log("\u274C \u0422\u0435\u0441\u0442 \u043E\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D: \u043D\u0435\u0442 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044F");return}console.log("\u{1F4E6} \u041F\u043E\u043B\u0443\u0447\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...");let t=this.getContacts();console.log("- \u0422\u0435\u043B\u0435\u0444\u043E\u043D:",t.phone),console.log("- Email:",t.email),console.log("- \u0421\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u044B\u0445 \u0441\u0435\u0442\u0435\u0439:",t.social.length),console.log("\u2795 \u0422\u0435\u0441\u0442 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u044F \u0441\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0439 \u0441\u0435\u0442\u0438..."),await this.addSocial({name:"YouTube",url:"https://youtube.com/komfort",icon:"YT"}),console.log("\u270F\uFE0F \u0422\u0435\u0441\u0442 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u0441\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0439 \u0441\u0435\u0442\u0438..."),t.social.length>0&&await this.updateSocial(0,{url:"https://vk.com/komfort_updated"}),console.log("\u2705 \u0412\u0441\u0435 \u0442\u0435\u0441\u0442\u044B \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u044B")}async forceLoadFromSupabase(){console.log("\u{1F504} \u041F\u0440\u0438\u043D\u0443\u0434\u0438\u0442\u0435\u043B\u044C\u043D\u0430\u044F \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0438\u0437 Supabase..."),await this.loadFromSupabase()}clearCache(){console.log("\u{1F9F9} \u041E\u0447\u0438\u0441\u0442\u043A\u0430 \u043A\u044D\u0448\u0430 localStorage..."),localStorage.removeItem(this.storageKey);let o=this.getDefaultContacts();this.contactsSubject.next(o),this.saveToLocalStorage(o)}async addTestSocial(){console.log("\u2795 \u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0435\u043C \u0442\u0435\u0441\u0442\u043E\u0432\u0443\u044E \u0441\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u0443\u044E \u0441\u0435\u0442\u044C...");let o={name:`Test Social ${Date.now()}`,url:"https://test.example.com",icon:"TEST"};await this.addSocial(o),console.log("\u2705 \u0422\u0435\u0441\u0442\u043E\u0432\u0430\u044F \u0441\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u0430\u044F \u0441\u0435\u0442\u044C \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0430")}async syncToSupabase(){if(console.log("\u{1F504} \u0421\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u044F \u043A\u043E\u043D\u0442\u0430\u043A\u0442\u043E\u0432 \u0441 Supabase..."),this.storageMode==="supabase"){console.log("\u0423\u0436\u0435 \u0432 \u0440\u0435\u0436\u0438\u043C\u0435 Supabase, \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u044F \u043D\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044F");return}console.log("\u26A0\uFE0F \u0421\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u044F \u043F\u043E\u043A\u0430 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u0430. \u0414\u043E\u0431\u0430\u0432\u044C\u0442\u0435 \u043C\u0435\u0442\u043E\u0434 updateContactInfo \u0432 SupabaseService")}static \u0275fac=function(t){return new(t||c)(l(g))};static \u0275prov=r({token:c,factory:c.\u0275fac,providedIn:"root"})};export{u as a};
