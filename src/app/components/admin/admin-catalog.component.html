<div class="admin-section">
  <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞–º–∏</h2>
  
  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
  @if (notification()) {
    <div class="notification" [class]="notification()?.type" (click)="hideNotification()">
      {{ notification()?.message }}
      <button class="notification-close">√ó</button>
    </div>
  }

  <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
  @if (isLoading()) {
    <div class="loading-overlay">
      <div class="loading-spinner">
        <div class="spinner"></div>
      </div>
    </div>
  }
  
  <button class="btn btn-primary" (click)="showAddForm()">
    + –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
  </button>

  <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
  @if (showForm) {
    <div class="admin-form">
      <h3>{{ editingCategory ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '–î–æ–±–∞–≤–∏—Ç—å' }} –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
      
      <div class="form-group">
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</label>
        <input [(ngModel)]="currentCategory.title" 
               class="form-control"
               (input)="onTitleChange()"
               placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ì–æ—Å—Ç–∏–Ω–∞—è">
      </div>
      
      <!-- Slug –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ -->
      <div class="form-group">
        <label>URL –∞–¥—Ä–µ—Å (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):</label>
        <input [(ngModel)]="currentCategory.slug" 
               class="form-control"
               placeholder="gostinaya"
               (blur)="onSlugBlur()"
               [class.is-invalid]="currentCategory.slug && !isSlugValid(currentCategory.slug)">
        
        <!-- –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ slug –Ω–µ —É–Ω–∏–∫–∞–ª–µ–Ω -->
        @if (currentCategory.slug && !isSlugUnique(currentCategory.slug, currentCategory.id)) {
          <div class="invalid-feedback">
            –≠—Ç–æ—Ç URL —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π
          </div>
        }
        
        <small class="help-text">
          –≠—Ç–æ—Ç –∞–¥—Ä–µ—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å—Å—ã–ª–∫–∞—Ö –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é. –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        </small>
      </div>
      
      <div class="form-group">
        <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</label>
        
        <!-- –ü–æ–ª–µ –¥–ª—è URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
        <input [(ngModel)]="currentCategory.image" 
               class="form-control" 
               placeholder="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª">
        
        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ -->
        <div class="file-upload-section">
          <label class="file-upload-label">
            <input type="file" 
                   #fileInput
                   (change)="onFileSelected($event)"
                   accept="image/*"
                   class="file-input">
          </label>
          
          @if (selectedFile) {
            <div class="file-info">
              <div class="file-preview">
                <img [src]="filePreview" 
                     [alt]="selectedFile.name || '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ'" 
                     loading="lazy" 
                     class="preview-image"
                     style="max-width: 120px; max-height: 120px; object-fit: contain;">
                <div class="file-details">
                  <span>{{ selectedFile ? getShortFileName(selectedFile.name, 25) : '' }}</span>
                  <button type="button" (click)="clearFile()" class="btn-remove">
                    √ó
                  </button>
                </div>
              </div>
            </div>
          }
          
          @if (!selectedFile && currentCategory.image) {
            <div class="current-image">
              <p>–¢–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</p>
              <img [src]="currentCategory.image" 
                   [alt]="currentCategory.title" 
                   loading="lazy" 
                   class="current-image-preview"
                   style="max-width: 200px; max-height: 150px; object-fit: contain;">
            </div>
          }
        </div>
        
        <small class="help-text">
          –£–∫–∞–∂–∏—Ç–µ URL –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (JPG, PNG, GIF). –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 400√ó400px
        </small>
      </div>
      
      <div class="form-group">
        <label>–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
        <input type="number" 
               [(ngModel)]="currentCategory.order" 
               class="form-control"
               min="0"
               placeholder="0">
      </div>
      
      <div class="form-group">
        <label>
          <input type="checkbox" 
                 [(ngModel)]="currentCategory.isActive"
                 [checked]="currentCategory.isActive ?? true">
          –ê–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
        </label>
      </div>
      
      <div class="form-actions">
        <button (click)="saveCategory()" class="btn btn-success" [disabled]="isLoading()">
          {{ editingCategory ? '–û–±–Ω–æ–≤–∏—Ç—å' : '–°–æ–∑–¥–∞—Ç—å' }} –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        </button>
        <button (click)="cancelEdit()" class="btn btn-secondary" [disabled]="isLoading()">
          –û—Ç–º–µ–Ω–∞
        </button>
      </div>
    </div>
  }

  <!-- –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
  @if (categories().length > 0) {
    <div class="categories-list">
      @for (category of categories(); track category.id) {
        <div class="category-item">
          <img [src]="category.image || '/assets/default-category.jpg'" 
               [alt]="category.title"
               loading="lazy"  
               class="category-thumb"
               (error)="category.image = '/assets/default-category.jpg'">
          <div class="category-info">
            <h4>{{ category.title }}</h4>
            <div class="category-details">
              <span class="detail-item">
                <strong>URL:</strong> {{ category.slug }}
              </span>
              <span class="detail-item">
                <strong>–ü–æ—Ä—è–¥–æ–∫:</strong> {{ category.order }}
              </span>
              <span class="detail-item">
                <strong>–°—Ç–∞—Ç—É—Å:</strong> 
                <span class="status-badge" [class.active]="category.isActive">
                  {{ category.isActive ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–ù–µ–∞–∫—Ç–∏–≤–Ω–∞' }}
                </span>
              </span>
            </div>
          </div>
          <div class="category-actions">
            <button (click)="editCategory(category)" 
                    class="btn btn-sm btn-edit"
                    title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
              ‚úèÔ∏è
            </button>
            <button (click)="deleteCategory(category)" 
                    class="btn btn-sm btn-danger"
                    title="–£–¥–∞–ª–∏—Ç—å">
              üóëÔ∏è
            </button>
          </div>
        </div>
      }
    </div>
  } @else {
    <div class="empty-state">
      <div class="empty-icon">üìÅ</div>
      <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</h3>
      <p>–ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é", —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</p>
    </div>
  }
</div>