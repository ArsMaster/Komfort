import{a as b}from"./chunk-WCF7E4PB.js";import{L as d,P as f,a as h,b as p,g as c}from"./chunk-TFJ7GAPU.js";var m=class g{constructor(e){this.supabaseService=e;console.log("=== HomePageService \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D ==="),window.homePageService=this,window.homePageServiceDebug={getMode:()=>this.storageMode,testConnection:()=>this.testConnection(),testAll:()=>this.testAllOperations(),forceLoadFromSupabase:()=>this.forceLoadFromSupabase(),clearCache:()=>this.clearCache()},this.initialize()}settingsSubject=new c(this.getDefaultSettings());slidesSubject=new c(this.getDefaultSlides());companyInfoSubject=new c(this.getDefaultCompanyInfo());settings$=this.settingsSubject.asObservable();slides$=this.slidesSubject.asObservable();companyInfo$=this.companyInfoSubject.asObservable();storageMode="local";SETTINGS_KEY="homepage_settings";SLIDES_KEY="homepage_slides";COMPANY_KEY="company_info";isInitialized=!1;async initialize(){this.isInitialized||(this.storageMode=localStorage.getItem("komfort_storage_mode")||"supabase",console.log("\u{1F527} \u0420\u0435\u0436\u0438\u043C \u0440\u0430\u0431\u043E\u0442\u044B HomePageService:",this.storageMode),this.storageMode==="local"?this.loadFromLocalStorage():await this.loadFromSupabase(),this.isInitialized=!0,console.log("\u2705 HomePageService \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D"))}loadFromLocalStorage(){console.log("\u{1F4E6} \u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage...");let e=localStorage.getItem(this.SETTINGS_KEY);if(e)try{let o=JSON.parse(e);this.settingsSubject.next(o),console.log("\u2705 \u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u044B \u0438\u0437 localStorage")}catch(o){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A:",o),this.settingsSubject.next(this.getDefaultSettings())}else console.log("\u{1F4ED} \u041D\u0435\u0442 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u043D\u044B\u0445 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A, \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u044E\u0442\u0441\u044F \u043D\u0430\u0447\u0430\u043B\u044C\u043D\u044B\u0435"),this.settingsSubject.next(this.getDefaultSettings());let t=localStorage.getItem(this.SLIDES_KEY);if(t)try{let o=JSON.parse(t);this.slidesSubject.next(o),console.log("\u2705 \u0421\u043B\u0430\u0439\u0434\u044B \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u044B \u0438\u0437 localStorage:",o.length)}catch(o){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0441\u043B\u0430\u0439\u0434\u043E\u0432:",o),this.slidesSubject.next(this.getDefaultSlides())}else console.log("\u{1F4ED} \u041D\u0435\u0442 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u043D\u044B\u0445 \u0441\u043B\u0430\u0439\u0434\u043E\u0432, \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u044E\u0442\u0441\u044F \u043D\u0430\u0447\u0430\u043B\u044C\u043D\u044B\u0435"),this.slidesSubject.next(this.getDefaultSlides());let i=localStorage.getItem(this.COMPANY_KEY);if(i)try{let o=JSON.parse(i);this.companyInfoSubject.next(o),console.log("\u2705 \u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043E \u043A\u043E\u043C\u043F\u0430\u043D\u0438\u0438 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u0430 \u0438\u0437 localStorage")}catch(o){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0438 \u043E \u043A\u043E\u043C\u043F\u0430\u043D\u0438\u0438:",o),this.companyInfoSubject.next(this.getDefaultCompanyInfo())}else console.log("\u{1F4ED} \u041D\u0435\u0442 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u043D\u043E\u0439 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0438 \u043E \u043A\u043E\u043C\u043F\u0430\u043D\u0438\u0438, \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u044E\u0442\u0441\u044F \u043D\u0430\u0447\u0430\u043B\u044C\u043D\u044B\u0435"),this.companyInfoSubject.next(this.getDefaultCompanyInfo())}async loadFromSupabase(){console.log("\u{1F504} \u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 Supabase...");try{if(!await this.testConnection()){console.warn("\u26A0\uFE0F \u041D\u0435\u0442 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044F \u043A Supabase, \u043F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0430\u0435\u043C\u0441\u044F \u043D\u0430 localStorage"),this.storageMode="local",this.loadFromLocalStorage();return}let t=await this.supabaseService.getHomepageSettings();if(t)this.settingsSubject.next(t),this.saveToLocalStorage(this.SETTINGS_KEY,t),console.log("\u2705 \u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u044B \u0438\u0437 Supabase");else{console.log("\u{1F4ED} Supabase: \u043D\u0435\u0442 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A, \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u044B\u0435");let s=this.getDefaultSettings();this.settingsSubject.next(s),this.saveToLocalStorage(this.SETTINGS_KEY,s)}let i=await this.supabaseService.getSlides();if(i&&i.length>0){let s=this.cleanSlideImageUrls(i);this.slidesSubject.next(s),this.saveToLocalStorage(this.SLIDES_KEY,s),console.log("\u2705 \u0421\u043B\u0430\u0439\u0434\u044B \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u044B \u0438\u0437 Supabase:",s.length),console.log("\u{1F4CA} \u0421\u043B\u0430\u0439\u0434\u044B \u043F\u043E\u0441\u043B\u0435 \u0438\u0441\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u044F \u043F\u0443\u0442\u0435\u0439:"),s.forEach((a,l)=>{console.log(`  ${l+1}. ${a.title}: ${a.imageUrl||a.image}`)})}else{console.log("\u{1F4ED} Supabase: \u043D\u0435\u0442 \u0441\u043B\u0430\u0439\u0434\u043E\u0432, \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u044B\u0435");let s=this.getDefaultSlides(),a=this.cleanSlideImageUrls(s);this.slidesSubject.next(a),this.saveToLocalStorage(this.SLIDES_KEY,a)}let o=await this.supabaseService.getContactInfo();if(o){console.log("\u{1F4C4} \u041F\u043E\u043B\u0443\u0447\u0435\u043D\u044B \u043A\u043E\u043D\u0442\u0430\u043A\u0442\u044B \u0441 about_sections:",{hasAboutSections:!!o.about_sections,aboutSectionsType:typeof o.about_sections,aboutSectionsCount:Array.isArray(o.about_sections)?o.about_sections.length:0,aboutSections:o.about_sections});let s=n=>{if(!n||typeof n!="string")return n||"";let r=n.trim(),S=Math.floor(r.length/2);if(S>0){let u=r.substring(0,S).trim(),v=r.substring(S).trim();if(u===v)return console.log(`\u{1F504} \u041E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D\u043E \u0438 \u0438\u0441\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u043E \u0434\u0443\u0431\u043B\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435: "${r}" \u2192 "${u}"`),u}return r},a=[];if(o.about_sections)try{if(Array.isArray(o.about_sections))a=o.about_sections.map(n=>({title:n.title||"",content:n.content||""}));else if(typeof o.about_sections=="string"){let n=JSON.parse(o.about_sections);Array.isArray(n)&&(a=n.map(r=>({title:r.title||"",content:r.content||""})))}}catch(n){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 about_sections:",n)}console.log("\u{1F4CB} \u041F\u0440\u0435\u043E\u0431\u0440\u0430\u0437\u043E\u0432\u0430\u043D\u043D\u044B\u0435 aboutSections:",a);let l={address:s(o.office||""),phone:s(o.phone||""),email:s(o.email||""),workHours:s(o.workingHours||""),aboutSections:a};console.log("\u{1F50D} \u041F\u0440\u043E\u0432\u0435\u0440\u043A\u0430 \u0434\u0430\u043D\u043D\u044B\u0445:",{originalAddress:o.office,cleanedAddress:l.address,originalPhone:o.phone,cleanedPhone:l.phone,originalWorkHours:o.workingHours,cleanedWorkHours:l.workHours,aboutSectionsCount:a.length}),this.companyInfoSubject.next(l),this.saveToLocalStorage(this.COMPANY_KEY,l),console.log("\u2705 \u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043E \u043A\u043E\u043C\u043F\u0430\u043D\u0438\u0438 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u0430 \u0438\u0437 Supabase \u0441 aboutSections")}else{console.log("\u{1F4ED} Supabase: \u043D\u0435\u0442 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0438 \u043E \u043A\u043E\u043C\u043F\u0430\u043D\u0438\u0438, \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u0443\u044E");let s=this.getDefaultCompanyInfo();this.companyInfoSubject.next(s),this.saveToLocalStorage(this.COMPANY_KEY,s)}}catch(e){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0438\u0437 Supabase:",e),console.log("\u{1F504} \u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0430\u0435\u043C\u0441\u044F \u043D\u0430 LocalStorage"),this.storageMode="local",this.loadFromLocalStorage()}}saveToLocalStorage(e,t){try{localStorage.setItem(e,JSON.stringify(t)),console.log(`\u{1F4BE} \u0414\u0430\u043D\u043D\u044B\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u044B \u0432 localStorage (${e}):`,t)}catch(i){console.error(`\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F \u0432 localStorage (${e}):`,i)}}getSettings(){return this.settingsSubject.getValue()}getSlides(){return this.slidesSubject.getValue()}getCompanyInfo(){return this.companyInfoSubject.getValue()}async updateSettings(e){if(console.log("\u270F\uFE0F \u041E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u0432 \u0440\u0435\u0436\u0438\u043C\u0435:",this.storageMode),this.storageMode==="local")this.settingsSubject.next(e),this.saveToLocalStorage(this.SETTINGS_KEY,e),console.log("\u2705 \u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B \u0432 LocalStorage");else try{await this.supabaseService.updateHomepageSettings(e)?(this.settingsSubject.next(e),this.saveToLocalStorage(this.SETTINGS_KEY,e),console.log("\u2705 \u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B \u0432 Supabase")):(console.warn("\u26A0\uFE0F \u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0432 Supabase, \u0441\u043E\u0445\u0440\u0430\u043D\u044F\u0435\u043C \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u043E"),this.settingsSubject.next(e),this.saveToLocalStorage(this.SETTINGS_KEY,e))}catch(t){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u0432 Supabase:",t),this.settingsSubject.next(e),this.saveToLocalStorage(this.SETTINGS_KEY,e)}}async updateSlides(e){if(console.log("\u270F\uFE0F \u041E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435 \u0441\u043B\u0430\u0439\u0434\u043E\u0432 \u0432 \u0440\u0435\u0436\u0438\u043C\u0435:",this.storageMode),this.storageMode==="local")this.slidesSubject.next(e),this.saveToLocalStorage(this.SLIDES_KEY,e),console.log("\u2705 \u0421\u043B\u0430\u0439\u0434\u044B \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B \u0432 LocalStorage:",e.length);else try{let t=e.map(o=>({image:o.image,title:o.title,description:o.description,link:o.link||"",isActive:o.isActive!==void 0?o.isActive:!0}));await this.supabaseService.updateSlides(t)?(this.slidesSubject.next(e),this.saveToLocalStorage(this.SLIDES_KEY,e),console.log("\u2705 \u0421\u043B\u0430\u0439\u0434\u044B \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B \u0432 Supabase:",e.length)):(console.warn("\u26A0\uFE0F \u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u043B\u0430\u0439\u0434\u044B \u0432 Supabase, \u0441\u043E\u0445\u0440\u0430\u043D\u044F\u0435\u043C \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u043E"),this.slidesSubject.next(e),this.saveToLocalStorage(this.SLIDES_KEY,e))}catch(t){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u0441\u043B\u0430\u0439\u0434\u043E\u0432 \u0432 Supabase:",t),this.slidesSubject.next(e),this.saveToLocalStorage(this.SLIDES_KEY,e)}}async updateCompanyInfo(e){if(console.log("\u270F\uFE0F \u041E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0438 \u043E \u043A\u043E\u043C\u043F\u0430\u043D\u0438\u0438 \u0432 \u0440\u0435\u0436\u0438\u043C\u0435:",this.storageMode),this.storageMode==="local")this.companyInfoSubject.next(e),this.saveToLocalStorage(this.COMPANY_KEY,e),console.log("\u2705 \u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043E \u043A\u043E\u043C\u043F\u0430\u043D\u0438\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0430 \u0432 LocalStorage");else try{let t={phone:e.phone,email:e.email,office:e.address,workingHours:e.workHours,aboutSections:e.aboutSections||[]};await this.supabaseService.updateContactInfo(t)?(this.companyInfoSubject.next(e),this.saveToLocalStorage(this.COMPANY_KEY,e),console.log("\u2705 \u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043E \u043A\u043E\u043C\u043F\u0430\u043D\u0438\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0430 \u0432 Supabase \u0441 aboutSections")):(console.warn("\u26A0\uFE0F \u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044E \u0432 Supabase, \u0441\u043E\u0445\u0440\u0430\u043D\u044F\u0435\u043C \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u043E"),this.companyInfoSubject.next(e),this.saveToLocalStorage(this.COMPANY_KEY,e))}catch(t){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0438 \u0432 Supabase:",t),this.companyInfoSubject.next(e),this.saveToLocalStorage(this.COMPANY_KEY,e)}}getDefaultSettings(){return{title:"Komfort - \u041C\u0435\u0431\u0435\u043B\u044C \u0438 \u0442\u043E\u0432\u0430\u0440\u044B \u0434\u043B\u044F \u0434\u043E\u043C\u0430",description:"\u041B\u0443\u0447\u0448\u0438\u0435 \u0442\u043E\u0432\u0430\u0440\u044B \u0434\u043B\u044F \u0432\u0430\u0448\u0435\u0433\u043E \u0434\u043E\u043C\u0430 \u043F\u043E \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u043C \u0446\u0435\u043D\u0430\u043C",bannerImages:[],featuredCategories:[]}}getDefaultSlides(){return[{image:"/assets/slide1.jpeg",title:"\u0412\u0441\u0435 \u0434\u043B\u044F \u0432\u0430\u0448\u0435\u0433\u043E \u0434\u043E\u043C\u0430",description:"\u0428\u0438\u0440\u043E\u043A\u0438\u0439 \u0430\u0441\u0441\u043E\u0440\u0442\u0438\u043C\u0435\u043D\u0442 \u043C\u0435\u0431\u0435\u043B\u0438 \u0438 \u0442\u043E\u0432\u0430\u0440\u043E\u0432 \u0434\u043B\u044F \u0434\u043E\u043C\u0430"},{image:"/assets/slide2.jpg",title:"\u041A\u0430\u0447\u0435\u0441\u0442\u0432\u043E \u0438 \u043D\u0430\u0434\u0435\u0436\u043D\u043E\u0441\u0442\u044C",description:"\u0422\u043E\u043B\u044C\u043A\u043E \u043F\u0440\u043E\u0432\u0435\u0440\u0435\u043D\u043D\u044B\u0435 \u043F\u0440\u043E\u0438\u0437\u0432\u043E\u0434\u0438\u0442\u0435\u043B\u0438 \u0438 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044B"},{image:"/assets/slide3.jpeg",title:"\u0414\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u0435 \u0446\u0435\u043D\u044B",description:"\u041B\u0443\u0447\u0448\u0435\u0435 \u0441\u043E\u043E\u0442\u043D\u043E\u0448\u0435\u043D\u0438\u0435 \u0446\u0435\u043D\u044B \u0438 \u043A\u0430\u0447\u0435\u0441\u0442\u0432\u0430 \u043D\u0430 \u0440\u044B\u043D\u043A\u0435"},{image:"/assets/slide4.jpg",title:"\u0411\u044B\u0441\u0442\u0440\u0430\u044F \u0434\u043E\u0441\u0442\u0430\u0432\u043A\u0430",description:"\u0414\u043E\u0441\u0442\u0430\u0432\u043A\u0430 \u043F\u043E \u0432\u0441\u0435\u0439 \u0420\u043E\u0441\u0441\u0438\u0438 \u0432 \u043A\u0440\u0430\u0442\u0447\u0430\u0439\u0448\u0438\u0435 \u0441\u0440\u043E\u043A\u0438"}]}getDefaultCompanyInfo(){return{address:"\u0427\u0435\u0447\u0435\u043D\u0441\u043A\u0430\u044F \u0420\u0435\u0441\u043F\u0443\u0431\u043B\u0438\u043A\u0430, \u0433. \u0428\u0435\u043B\u043A\u043E\u0432\u0441\u043A\u0430\u044F, \u0443\u043B. \u041A\u043E\u0441\u0430\u044F, 47",phone:"+7 (800) 123-45-67",email:"info@komfort.ru",workHours:"\u041F\u041D - \u0412\u0421 \u0441 8:00 \u0434\u043E 20:00",aboutSections:[{title:"\u041E\u043F\u044B\u0442",content:"\u041F\u0440\u043E\u0434\u0443\u043A\u0446\u0438\u044F Komfort \u0443\u0436\u0435 \u0431\u043E\u043B\u0435\u0435 13 \u043B\u0435\u0442 \u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0441\u044F \u0443\u0441\u043F\u0435\u0445\u043E\u043C \u0443 \u043F\u043E\u043A\u0443\u043F\u0430\u0442\u0435\u043B\u0435\u0439 \u0438 \u0440\u0435\u0430\u043B\u0438\u0437\u0443\u0435\u0442\u0441\u044F \u0432\u043E \u043C\u043D\u043E\u0433\u0438\u0445 \u0440\u0435\u0433\u0438\u043E\u043D\u0430\u0445 \u0420\u043E\u0441\u0441\u0438\u0438, \u0430 \u0442\u0430\u043A\u0436\u0435 \u044D\u043A\u0441\u043F\u043E\u0440\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044F \u0432 \u0441\u0442\u0440\u0430\u043D\u044B \u0421\u041D\u0413 \u0438 \u0415\u0432\u0440\u043E\u043F\u0443. \u0428\u0438\u0440\u043E\u043A\u0438\u0439 \u0430\u0441\u0441\u043E\u0440\u0442\u0438\u043C\u0435\u043D\u0442 \u0438 \u0431\u043E\u043B\u044C\u0448\u0430\u044F \u0441\u043A\u043B\u0430\u0434\u0441\u043A\u0430\u044F \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0430 \u043F\u043E\u0437\u0432\u043E\u043B\u044F\u044E\u0442 \u043D\u0430\u0448\u0438\u043C \u043A\u043B\u0438\u0435\u043D\u0442\u0430\u043C \u0431\u044B\u0441\u0442\u0440\u043E \u0438 \u0432\u044B\u0433\u043E\u0434\u043D\u043E \u0434\u0435\u043B\u0430\u0442\u044C \u0441 \u043D\u0430\u043C\u0438 \u0431\u0438\u0437\u043D\u0435\u0441."},{title:"\u0421\u043E\u0432\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0439 \u043C\u043E\u0434\u0435\u043B\u044C\u043D\u044B\u0439 \u0440\u044F\u0434",content:"Komfort \u0441\u043B\u0435\u0434\u0438\u0442 \u0437\u0430 \u0442\u0435\u043D\u0434\u0435\u043D\u0446\u0438\u044F\u043C\u0438 \u043D\u0430 \u0440\u044B\u043D\u043A\u0435 \u0442\u043E\u0432\u0430\u0440\u043E\u0432 \u0434\u043B\u044F \u0434\u043E\u043C\u0430 \u0438 \u0441\u0432\u0435\u0436\u0438\u043C\u0438 \u0438\u0434\u0435\u044F\u043C\u0438 \u0432 \u0434\u0438\u0437\u0430\u0439\u043D\u0435 \u0438\u043D\u0442\u0435\u0440\u044C\u0435\u0440\u043E\u0432. \u041D\u0430\u0448 \u043A\u043E\u043B\u043B\u0435\u043A\u0442\u0438\u0432 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u043F\u043E\u0441\u0442\u043E\u044F\u043D\u043D\u044B\u043C \u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u043E\u043C \u043C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u044B\u0445 \u0432\u044B\u0441\u0442\u0430\u0432\u043E\u043A \u0438 \u0444\u043E\u0440\u0443\u043C\u043E\u0432, \u0433\u0434\u0435 \u043D\u0430\u0431\u0438\u0440\u0430\u0435\u0442\u0441\u044F \u043E\u043F\u044B\u0442\u0430 \u0438 \u0434\u0435\u043B\u0438\u0442\u0441\u044F \u0441\u0432\u043E\u0438\u043C. \u041F\u0440\u043E\u0434\u0443\u043A\u0446\u0438\u044F \u043F\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043B\u0435\u043D\u0430 \u0431\u043E\u043B\u0435\u0435 \u0447\u0435\u043C \u0432 50 \u0441\u0430\u043B\u043E\u043D\u0430\u0445 \u043F\u043E \u0432\u0441\u0435\u0439 \u0441\u0442\u0440\u0430\u043D\u0435."},{title:"\u041F\u0440\u043E\u0438\u0437\u0432\u043E\u0434\u0441\u0442\u0432\u043E",content:"\u041F\u0440\u043E\u0438\u0437\u0432\u043E\u0434\u0441\u0442\u0432\u0435\u043D\u043D\u044B\u0439 \u043A\u043E\u043C\u043F\u043B\u0435\u043A\u0441 \u0437\u0430\u043D\u0438\u043C\u0430\u0435\u0442 15 000 \u043A\u0432. \u043C \u0438 \u0432\u043A\u043B\u044E\u0447\u0430\u0435\u0442 \u0432 \u0441\u0435\u0431\u044F 7 \u0446\u0435\u0445\u043E\u0432 \u043F\u043E\u043B\u043D\u043E\u0433\u043E \u0446\u0438\u043A\u043B\u0430 \u043F\u0440\u043E\u0438\u0437\u0432\u043E\u0434\u0441\u0442\u0432\u0430 \u043C\u0435\u0431\u0435\u043B\u0438 \u0438 \u0434\u043E\u043C\u0430\u0448\u043D\u0435\u0433\u043E \u0442\u0435\u043A\u0441\u0442\u0438\u043B\u044F \u043D\u0430 \u043E\u0431\u043E\u0440\u0443\u0434\u043E\u0432\u0430\u043D\u0438\u0438 \u0432\u0435\u0434\u0443\u0449\u0438\u0445 \u043C\u0438\u0440\u043E\u0432\u044B\u0445 \u043F\u0440\u043E\u0438\u0437\u0432\u043E\u0434\u0438\u0442\u0435\u043B\u0435\u0439. \u041E\u0441\u043E\u0431\u043E\u0435 \u0432\u043D\u0438\u043C\u0430\u043D\u0438\u0435 \u043C\u044B \u0443\u0434\u0435\u043B\u044F\u0435\u043C \u043F\u043E\u0434\u0431\u043E\u0440\u0443 \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A\u043E\u0432, \u0447\u0442\u043E\u0431\u044B \u043D\u0430\u0448 \u043A\u043E\u043B\u043B\u0435\u043A\u0442\u0438\u0432 \u043F\u0440\u0438\u0440\u0430\u0441\u0442\u0430\u043B \u0442\u043E\u043B\u044C\u043A\u043E \u043F\u0440\u043E\u0444\u0435\u0441\u0441\u0438\u043E\u043D\u0430\u043B\u044C\u043D\u044B\u043C\u0438 \u0438 \u043E\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043D\u043D\u044B\u043C\u0438 \u043B\u044E\u0434\u044C\u043C\u0438."}]}}getStorageMode(){return this.storageMode}async switchStorageMode(e){if(this.storageMode===e){console.log(`\u2139\uFE0F \u0423\u0436\u0435 \u0432 \u0440\u0435\u0436\u0438\u043C\u0435 ${e}`);return}console.log(`\u{1F504} \u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435 \u0440\u0435\u0436\u0438\u043C\u0430 \u0441 ${this.storageMode} \u043D\u0430 ${e}`),this.storageMode=e,e==="local"?this.loadFromLocalStorage():await this.loadFromSupabase()}fixSlideImageUrl(e){if(!e||e.trim()==="")return"/assets/default-slide.jpg";let t=e.trim();return t.includes("supabase.co")||t.includes("storage/v1/object/public")||t.startsWith("/assets/")?t:t.startsWith("assets/")?"/"+t:t.match(/\.(jpg|jpeg|png|gif|webp)$/i)?"/assets/"+t:t.startsWith("http")?(t.includes("supabase.co"),t):"/assets/default-slide.jpg"}cleanSlideImageUrls(e){return!e||!Array.isArray(e)?[]:e.map(t=>p(h({},t),{imageUrl:this.fixSlideImageUrl(t.image||t.imageUrl)}))}async testConnection(){console.log("\u{1F50C} \u0422\u0435\u0441\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044F \u043A Supabase (HomePage)...");try{let e=await this.supabaseService.getHomepageSettings();return console.log("\u2705 \u041F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435 \u043A Supabase \u0443\u0441\u043F\u0435\u0448\u043D\u043E"),!0}catch(e){return console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044F:",e.message||e),!1}}async testAllOperations(){if(console.log("\u{1F9EA} \u0417\u0430\u043F\u0443\u0441\u043A \u0442\u0435\u0441\u0442\u043E\u0432\u044B\u0445 \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u0439 HomePageService..."),!await this.testConnection()){console.log("\u274C \u0422\u0435\u0441\u0442 \u043E\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D: \u043D\u0435\u0442 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044F");return}console.log("\u{1F4E6} \u041F\u043E\u043B\u0443\u0447\u0430\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435..."),console.log("- \u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438:",this.getSettings().title),console.log("- \u0421\u043B\u0430\u0439\u0434\u043E\u0432:",this.getSlides().length),console.log("- \u041A\u043E\u043C\u043F\u0430\u043D\u0438\u044F:",this.getCompanyInfo().phone),console.log("\u2705 \u0412\u0441\u0435 \u0442\u0435\u0441\u0442\u044B \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u044B")}async forceLoadFromSupabase(){console.log("\u{1F504} \u041F\u0440\u0438\u043D\u0443\u0434\u0438\u0442\u0435\u043B\u044C\u043D\u0430\u044F \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0438\u0437 Supabase..."),await this.loadFromSupabase()}async uploadSlideImage(e){try{console.log("\u{1F4E4} [HomePageService] \u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u0441\u043B\u0430\u0439\u0434\u0430...");let t=e.name.split(".").pop()?.toLowerCase()||"jpg",o=`slides/${`${Date.now()}_${Math.random().toString(36).substring(7)}.${t}`}`,s=this.supabaseService.getClient(),{data:a,error:l}=await s.storage.from("slides").upload(o,e,{cacheControl:"3600",upsert:!1,contentType:e.type});if(l)throw l;let{data:n}=s.storage.from("slides").getPublicUrl(o);return n.publicUrl}catch(t){throw console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0441\u043B\u0430\u0439\u0434\u0430:",t),t}}clearCache(){console.log("\u{1F9F9} \u041E\u0447\u0438\u0441\u0442\u043A\u0430 \u043A\u044D\u0448\u0430 localStorage..."),localStorage.removeItem(this.SETTINGS_KEY),localStorage.removeItem(this.SLIDES_KEY),localStorage.removeItem(this.COMPANY_KEY),this.settingsSubject.next(this.getDefaultSettings()),this.slidesSubject.next(this.getDefaultSlides()),this.companyInfoSubject.next(this.getDefaultCompanyInfo()),this.saveToLocalStorage(this.SETTINGS_KEY,this.getDefaultSettings()),this.saveToLocalStorage(this.SLIDES_KEY,this.getDefaultSlides()),this.saveToLocalStorage(this.COMPANY_KEY,this.getDefaultCompanyInfo())}async initializeHomepageData(){console.log("\u{1F527} \u0418\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0430\u0446\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445 \u0433\u043B\u0430\u0432\u043D\u043E\u0439 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u044B \u0432 Supabase...");try{let e=await this.supabaseService.getHomepageSettings(),t=await this.supabaseService.getSlides(),i=await this.supabaseService.getContactInfo();if(!e){console.log("\u2795 \u0421\u043E\u0437\u0434\u0430\u0435\u043C \u043D\u0430\u0447\u0430\u043B\u044C\u043D\u044B\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0432 Supabase...");let o=this.getDefaultSettings();console.log("\u26A0\uFE0F \u041C\u0435\u0442\u043E\u0434 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u043F\u043E\u043A\u0430 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D")}if(!t||t.length===0){console.log("\u2795 \u0421\u043E\u0437\u0434\u0430\u0435\u043C \u043D\u0430\u0447\u0430\u043B\u044C\u043D\u044B\u0435 \u0441\u043B\u0430\u0439\u0434\u044B \u0432 Supabase...");let o=this.getDefaultSlides();console.log("\u26A0\uFE0F \u041C\u0435\u0442\u043E\u0434 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u0441\u043B\u0430\u0439\u0434\u043E\u0432 \u043F\u043E\u043A\u0430 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D")}if(!i){console.log("\u2795 \u0421\u043E\u0437\u0434\u0430\u0435\u043C \u043D\u0430\u0447\u0430\u043B\u044C\u043D\u0443\u044E \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044E \u043E \u043A\u043E\u043C\u043F\u0430\u043D\u0438\u0438 \u0432 Supabase...");let o=this.getDefaultCompanyInfo();console.log("\u26A0\uFE0F \u041C\u0435\u0442\u043E\u0434 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0438 \u043E \u043A\u043E\u043C\u043F\u0430\u043D\u0438\u0438 \u043F\u043E\u043A\u0430 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D")}console.log("\u2705 \u0418\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0430\u0446\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0430")}catch(e){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0430\u0446\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445:",e)}}async syncToSupabase(){console.log("\u{1F504} \u0421\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445 \u0433\u043B\u0430\u0432\u043D\u043E\u0439 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u044B \u0441 Supabase...");try{let e=this.getSettings(),t=await this.supabaseService.updateHomepageSettings(e);console.log(t?"\u2705 \u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u044B":"\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u0438 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A");let i=this.getSlides(),o=i.map(r=>({image:r.image,title:r.title,description:r.description,link:r.link||"",isActive:r.isActive!==void 0?r.isActive:!0})),s=await this.supabaseService.updateSlides(o);console.log(s?`\u2705 ${i.length} \u0441\u043B\u0430\u0439\u0434\u043E\u0432 \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u044B`:"\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u0438 \u0441\u043B\u0430\u0439\u0434\u043E\u0432");let a=this.getCompanyInfo(),l={phone:a.phone,email:a.email,office:a.address,workingHours:a.workHours,aboutSections:JSON.stringify(a.aboutSections||[])},n=await this.supabaseService.updateContactInfo(l);console.log(n?"\u2705 \u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043E \u043A\u043E\u043C\u043F\u0430\u043D\u0438\u0438 \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u0430":"\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u0438 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0438"),console.log("\u{1F389} \u0421\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u044F \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0430")}catch(e){console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u0438 \u0441 Supabase:",e)}}static \u0275fac=function(t){return new(t||g)(f(b))};static \u0275prov=d({token:g,factory:g.\u0275fac,providedIn:"root"})};export{m as a};
